<!doctype html>
<option>神崎豪</option>
<option>風間裕也</option>
<option>姫島ノエル</option>
</select>


<div class="row">
<button id="submitBtn" type="submit">送信する</button>
<a href="results.html" style="text-decoration:none"><button type="button" style="background:#111827">集計を見る</button></a>
</div>
<div id="ok" class="msg ok">ご協力ありがとうございます。回答を記録しました。</div>
<div id="er" class="msg err">送信に失敗しました。しばらくしてから再度お試しください。</div>
<p class="foot">※個人情報は取得しません。必要に応じてIP重複などの制御はGAS側で行ってください。</p>
</form>
</div>
</div>


<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbycx9SQFmWzeh2RTJuSLfK-laB6_68olzggVoCMGK9ZJK6jwSKsGEgECxQvlEJtDeco1g/exec";


const form = document.getElementById('poll-form');
const ok = document.getElementById('ok');
const er = document.getElementById('er');
const btn = document.getElementById('submitBtn');


function showMsg(el){el.style.display='block'; setTimeout(()=>el.style.display='none', 4000)}


async function trySubmit(payload){
// 1) JSON POST（推奨）
try{
const r = await fetch(WEB_APP_URL, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({action:'submit', ...payload})});
if(r.ok){return await r.json().catch(()=>({ok:true}))}
}catch(e){}
// 2) フォームURLエンコードPOST
try{
const body = new URLSearchParams({action:'submit', ...payload});
const r = await fetch(WEB_APP_URL, {method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body});
if(r.ok){return await r.json().catch(()=>({ok:true}))}
}catch(e){}
// 3) GET クエリ
const qs = new URLSearchParams({action:'submit', ...payload}).toString();
const r = await fetch(`${WEB_APP_URL}?${qs}`);
if(r.ok){try{return await r.json()}catch(e){return {ok:true}}}
throw new Error('submit failed');
}


form.addEventListener('submit', async (e)=>{
e.preventDefault();
ok.style.display=er.style.display='none';
btn.disabled=true; btn.textContent='送信中…';
const payload = {
district: document.getElementById('district').value,
issue: document.getElementById('issue').value,
candidate: document.getElementById('candidate').value,
ts: new Date().toISOString()
};
try{
await trySubmit(payload);
showMsg(ok); form.reset();
}catch(err){
console.error(err); showMsg(er);
}finally{ btn.disabled=false; btn.textContent='送信する'; }
});
</script>
</body>
</html>
